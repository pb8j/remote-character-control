<!DOCTYPE html>
<html>
<head>
    <title>Mobile View</title>
    <style>
        body { margin: 0; overflow: hidden; }
        #character {
            position: absolute;
            width: 50px;
            height: 50px;
            background-color: red;
            border-radius: 50%;
            transition: left 0.2s, bottom 0.2s;
        }
    </style>
</head>
<body>
    <div id="character"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script>
    const socket = io();
    const character = document.getElementById('character');

    // Character movement sync
    socket.on('character_moved', (position) => {
        character.style.left = `${position.x}px`;
        character.style.bottom = `${position.y}px`;
    });

    socket.on('gravity', (position) => {
        setTimeout(() => {
            character.style.bottom = `${position.y}px`;
        }, 300);
    });

    // Request initial character position
    socket.on('start_camera', () => {
    startCamera();
    console.log("Camera started");

});

socket.on('connect', () => {
    socket.emit('request_position');
});


    async function startCamera() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            const video = document.createElement('video');
            video.srcObject = stream;
            video.play();

            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');

            video.addEventListener('loadedmetadata', () => {
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;

                // Start capturing frames
                setInterval(() => {
    context.drawImage(video, 0, 0, canvas.width, canvas.height);
    const dataURL = canvas.toDataURL('image/jpeg').split(',')[1];
    socket.emit('mobile_camera_frame', { frame: dataURL });
    console.log("Sent frame to server");
}, 500); 

            });
        } catch (err) {
            console.error('Camera access denied:', err);
        }
    }
</script>

</body>
</html>